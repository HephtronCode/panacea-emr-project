services:
  # 1. API Service
  api:
    build: ./panacea-backend
    container_name: panacea_api
    restart: always
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
      - NODE_ENV=production
      # Secret passed from root .env or hardcoded here
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRE=${JWT_EXPIRE:-30d}

      # THE BRIDGE: Connect to your Laptop's MongoDB
      # host.docker.internal points to your actual machine from inside docker
      - MONGO_URI=mongodb://host.docker.internal:27017/panacea_db

      # Backend needs to know allowed Frontend Origin
      - FRONTEND_URL=http://localhost:3000

    # Ensure container can see the host network (Docker Desktop Feature)
    extra_hosts:
      - "host.docker.internal:host-gateway"

  # 2. UI Service
  ui:
    build:
      context: ./panacea-frontend
      args:
        # Browser access path (My Laptop's browser -> Laptop's Localhost)
        - VITE_API_URL=http://localhost:5000/api
    container_name: panacea_ui
    restart: always
    ports:
      - "3000:80" # Maps Laptop:3000 to Container:80 (Nginx)
    depends_on:
      - api